
import json
import os

def generate_index():
    # Load questions
    questions = []
    with open("questions.jsonl", "r") as f:
        for line in f:
            if line.strip():
                questions.append(json.loads(line)["question"])

    # Define models and their folders
    models = [
        ("PMC-LLaMA 13B", "axiong_PMC_LLaMA_13B"),
        ("GPT-4o", "gpt-4o"),
        ("Gemini 3 Pro", "gemini-3-pro-preview"),
        ("MedGemma 27B", "google_medgemma-27b-text-it"),
        ("Perplexity", "perplexity"),
    ]

    # Start Markdown content
    md_content = "# Medical Model Evaluation Results\n\n"
    md_content += "This file provides quick navigation to the responses generated by each model for the 20 medical questions.\n\n"
    
    # Generate Table Header
    md_content += "| ID | Question Snippet | " + " | ".join([m[0] for m in models]) + " |\n"
    md_content += "|:--:|:-----------------|" + "|".join([":---:" for _ in models]) + "|\n"

    # Generate Table Rows
    for i, q in enumerate(questions, 1):
        # Truncate question for display
        q_snippet = (q[:25] + '...') if len(q) > 25 else q
        q_snippet = q_snippet.replace("|", "\|") # Escape pipe characters
        
        row = f"| **{i}** | {q_snippet} | "
        
        for _, folder in models:
            # Check for .txt first, then .md
            file_path = f"{folder}/{i}.txt"
            if not os.path.exists(file_path):
                file_path = f"{folder}/{i}.md"

            if os.path.exists(file_path):
                row += f"[View]({file_path}) | "
            else:
                row += " - | "
        
        md_content += row + "\n"

    # Write to file
    with open("RESULTS_INDEX.md", "w") as f:
        f.write(md_content)
    
    print("RESULTS_INDEX.md generated successfully.")

if __name__ == "__main__":
    generate_index()
